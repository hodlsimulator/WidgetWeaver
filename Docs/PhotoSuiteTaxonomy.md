# Photo Suite Taxonomy

This document defines the app’s “Photo Suite” in user-meaningful terms and maps today’s starter templates to the underlying spec knobs that implement them.

The intent is to support a UX-first model (few entry points, many editable options) without growing template count as a proxy for hidden settings.

## What “Photo Suite” means

In this codebase, “Photo Suite” refers to designs that use the `.poster` template and render a photo as the primary backdrop.

A poster may be backed by either:

- A single prepared image file (single-photo posters).
- A Smart Photo payload (master + per-family renders) and, optionally, an album shuffle manifest (album-shuffle posters).

## North-star mental model

A poster can be described as:

Photo Source + Photo Treatment + Overlay Content + Overlay Style

These are the user-facing concepts that should remain stable even as implementation details change.

### Photo Source

Defines where the displayed photo comes from.

- Single Photo
  - One photo chosen by the user.
  - Backed by `ImageSpec.fileName` (and optionally `ImageSpec.smartPhoto` for per-family prepared renders).

- Smart Photos (Album Shuffle)
  - Photos rotate from an album.
  - Encoded as `ImageSpec.smartPhoto.shuffleManifestFileName != nil && != ""`.
  - The widget should still decode only one image per family per timeline entry; composition and selection happen in the app during preparation.

- Smart Photos (Memories)
  - A “virtual album” generated by the app (no album pick required).
  - Modes:
    - On this day: photos taken on the current day/month across years.
    - On this week: photos taken during the current week window across years.
  - Encoding (no schema change):
    - `ImageSpec.smartPhoto.shuffleManifestFileName` is set (manifest stored in App Group).
    - The shuffle manifest `sourceID` uses a stable prefix (e.g. `memories:onThisDay` / `memories:onThisWeek`) so the app can recognise and refresh it.
  - The widget continues to render by reading a single prepared image per family per timeline entry; selection and preparation happen in the app.

### Photo Treatment

Defines how the chosen photo is presented.

- Full-bleed
  - The photo fills the widget.
  - Implemented by `ImageSpec.contentMode == .fill`.

- Framed / Matte
  - A framed photo look (matte) is applied.
  - Implemented by `ImageSpec.contentMode == .fit`, which switches the poster background renderer into the matte-fit variant.

Future: Collage / composite treatments should remain within the “Photo Treatment” axis, not as separate widget templates.

### Overlay Content

Defines what, if anything, is layered on top of the photo.

- None
  - Photo-only.
  - Implemented by `LayoutSpec.posterOverlayMode == .none`.

- Caption
  - Title/subtitle overlay (poster text stack).
  - Implemented by `LayoutSpec.posterOverlayMode == .caption`.

Future: Clock and Quote are overlay content presets (still fundamentally “Caption”), implemented as deterministic edits to existing text + typography defaults.

### Overlay Style

Defines how the caption overlay is treated visually.

- Scrim
  - A soft gradient scrim fading away from the caption edge.
  - This is the default caption treatment.

- Glass
  - A frosted glass card/strip.
  - Current opt-in (no schema change):
    - `StyleSpec.backgroundOverlay == .subtleMaterial` AND
    - `StyleSpec.backgroundOverlayOpacity <= 0.0001`

Note: this overloads a global overlay token as a poster-only style hint. Stage 7 proposes making this explicit.

## Current encoding and hidden couplings

Several poster behaviours are implemented via indirect “hints” rather than explicit poster settings:

- Caption on/off: `LayoutSpec.posterOverlayMode`.
- Caption position (Top/Bottom): `LayoutAlignmentToken.topLeading/top/topTrailing` values.
- Glass caption: `StyleSpec.backgroundOverlay == .subtleMaterial` with effectively zero full-screen overlay opacity.
- Framed/matte: `ImageSpec.contentMode == .fit`.
- Memories mode (On this day/week): encoded in the shuffle manifest `sourceID` prefix; no spec schema keys are required.

## Starter template inventory → taxonomy mapping

The table below is the current catalogue of photo-related starter templates and their intended taxonomy interpretation.

Legend:
- “PosterOverlayMode”: `LayoutSpec.posterOverlayMode`
- “Alignment”: `LayoutSpec.alignment`
- “ContentMode”: `ImageSpec.contentMode`
- “Glass”: `StyleSpec.backgroundOverlay == .subtleMaterial` + opacity 0

| Template ID | Name | Photo Source | Treatment | Overlay Content | Overlay Style | Primary spec knobs | Notes |
|---|---|---|---|---|---|---|---|
| `starter-photo-single` | Photo | Single Photo | Full-bleed | None | N/A | `layout.posterOverlayMode = .none`; `image.contentMode = .fill` | Baseline poster. |
| `starter-photo-framed` | Photo (Framed) | Single Photo | Framed | None | N/A | `layout.posterOverlayMode = .none`; `image.contentMode = .fit` | Matte-fit variant. |
| `starter-photo-caption` | Photo + Caption | Single Photo | Full-bleed | Caption | Scrim | `layout.posterOverlayMode = .caption`; `alignment = .bottom*` | Baseline caption poster. |
| `starter-photo-caption-top` | Photo + Caption (Top) | Single Photo | Full-bleed | Caption | Scrim | `layout.posterOverlayMode = .caption`; `alignment = .top*` | A preset of alignment only. |
| `starter-photo-caption-glass` | Photo + Caption (Glass) | Single Photo | Full-bleed | Caption | Glass | `layout.posterOverlayMode = .caption`; `style.backgroundOverlay = .subtleMaterial`; `style.backgroundOverlayOpacity = 0` | Uses global overlay token as a style hint. |
| `starter-photo-clock` | Photo Clock | Single Photo | Full-bleed | Caption (Clock preset) | Scrim | `layout.posterOverlayMode = .caption`; `primaryText = "{{__time}}"`; `secondaryText = "{{__weekday}}"` | The caption overlay supports minute-level ticking without re-decoding the background photo. |
| `starter-photo-quote` | Photo Quote | Single Photo | Full-bleed | Caption (Quote preset) | Glass | `layout.posterOverlayMode = .caption`; `style.backgroundOverlay = .subtleMaterial`; `style.backgroundOverlayOpacity = 0` | Quote is a text/typography preset on top of the caption overlay. |

## Guardrails

1) Avoid template proliferation.

- Prefer a small number of Explore entry points and express variety via presets and editable controls.
- Keep legacy template IDs for back-compat (imports, deep links, existing saved designs) even when they are removed from surfaced lists.

2) Keep the widget extension cheap.

- One image decode per family per timeline entry.
- Any heavy work (cropping, selection, multi-photo composition) happens in the app during Smart Photo preparation.

3) Prefer explicit UX objects over implementation hacks.

- Poster-only settings should be represented as poster concepts (source/treatment/content/style), even if implementation temporarily reuses existing spec fields.

## Feature flag

New poster-specific editor surfaces should be gated for staged rollout.

- Flag: `FeatureFlags.posterSuiteEnabled`
- Key: `widgetweaver.feature.editor.posterSuite.enabled`

Memories modes will be staged behind a dedicated flag:

- Flag: `FeatureFlags.smartPhotoMemoriesEnabled` (planned)
- Key: `widgetweaver.feature.smartPhotos.memories.enabled` (planned)
