WidgetWeaver – chat handoff (copy/paste)
Last updated: 2026-01-24

Product
- WidgetWeaver is an iOS 26+ app that builds and previews real WidgetKit widgets via an Explore (template catalogue) + context-aware editor workflow.
- Widgets must be deterministic and budget-safe; heavy work (Vision, ranking, photo prep) happens in the app; widgets render from App Group state.
- Sharing/export uses a `.wwdesign` design package file type (JSON under the hood) for backup and exchange.

Strategic intent
- “Super complex, super simple”: powerful capabilities under the hood, but progressive disclosure in the UI.
- Ship a coherent flagship set, not a wide permission-heavy grab bag.

Near-term schedule
- Today: 2026-01-24.
- Feature freeze: 2026-01-31 (stop adding features).
- Polish: 2026-02-01 to 2026-02-14.
- Target ship: 2026-02-14 to 2026-02-16.

Current roadmap priorities (pre-freeze)
1) Photos: make Smart Photos + poster/photo widgets feel flagship (fast, reliable, good defaults).
2) Clock: Home Screen correctness and predictable customisation updates.
3) Weather (flagship): ship the rain-first Weather template + `__weather_*` variables with a clear location flow, stable caching, and attribution.
4) Noise Machine: promote it; keep responsiveness rock-solid; add 1–2 scoped upgrades only.
5) Variables: make them more accessible/discoverable, especially during text editing; surface built-in keys.
6) Catalogue and trust clean-up (usefulness-first; do not break existing widgets):
   - Remove “Reading” from Explore / starter surfaces.
   - Remove the “Photo Quote” template from Explore / starter surfaces.
   - Clipboard Actions (Screen Actions) is parked for this ship and must be absent in release builds:
     - Not listed in Explore/starter surfaces.
     - Not registered in the widget extension bundle (no Home Screen “Add Widget” gallery presence).
     - No dependency on ScreenActionsCore in the default build; no local-path SPM dependencies in the Xcode project.
     - `NSContactsUsageDescription` must not exist in `WidgetWeaver/Info.plist` (nor InfoPlist.strings).
   - Keep PawPulse / “Latest Cat” (cat adoption) out of shipped surfaces. The widget is compile-time gated (no gallery presence unless `PAWPULSE` is defined) and background refresh is runtime gated (`WidgetWeaverFeatureFlags.pawPulseEnabled`, default off). Refresh scheduling is cancelled when disabled (or when no base URL is configured).
   - Weather location safety: if the app can call `requestWhenInUseAuthorization()`, `WidgetWeaver/Info.plist` must contain `NSLocationWhenInUseUsageDescription` with a user-facing explanation.

Defer
- AI: post-ship R&D track; small, reviewable assistive steps; must generate explicit specs/config, not opaque state.

Key repo pointers
- Design export/import: WidgetWeaver/ContentView+SharePackage.swift (Transferable `.wwdesign` files)
- Document type registration: WidgetWeaver/Info.plist (UTType export + document type + open-in-place declaration)
- Privacy usage strings: WidgetWeaver/Info.plist (Location / Photos / etc.)
- Smart Photos pipeline: WidgetWeaver/SmartPhotoPipeline/*
- Crop editor: WidgetWeaver/SmartPhotoCropEditorView.swift
- Poster background/overlay: Shared/WidgetWeaverSpecView+Background.swift, Shared/WidgetWeaverSpecView.swift
- Home Screen clock widget: WidgetWeaverWidget/WidgetWeaverHomeScreenClockWidget.swift
- Clock live view: WidgetWeaverWidget/Clock/WidgetWeaverClockWidgetLiveView.swift
- Weather pipeline:
  - Engine (fetch + throttling): Shared/WidgetWeaverWeatherEngine.swift
  - Store (App Group): Shared/WidgetWeaverWeatherStore.swift
  - Template views: Shared/WidgetWeaverWeatherTemplateView.swift (and related `*NowcastChart*`, `*Layouts*`, `*Components*`)
  - Settings UX: WidgetWeaver/WidgetWeaverWeatherSettingsView.swift
  - Widget integration: WidgetWeaverWidget/WidgetWeaverWidget.swift (weather body)
- Noise Machine widget: WidgetWeaverWidget/WidgetWeaverNoiseMachineWidget.swift
- Template catalogue entries: WidgetWeaver/WidgetWeaverAboutCatalog.swift
- Variable resolution: Shared/WidgetSpec+Utilities.swift, Shared/WidgetSpec+VariableResolutionNow.swift
- Variables UI: WidgetWeaver/WidgetWeaverVariablesView.swift (and related sheets)

Feature removal / hiding pointers
- “Reading” template surfaces: WidgetWeaver/WidgetWeaverAboutCatalog.swift (and any Explore listings)
- “Photo Quote” template: WidgetWeaver/WidgetWeaverAboutCatalog.swift, Shared/WidgetSpec+Utilities.swift (spec helper)
- Clipboard Actions (parked; must be absent in release builds):
  - Widget registration: WidgetWeaverWidget/WidgetWeaverWidgetBundle.swift (gate behind the compiler flag `CLIPBOARD_ACTIONS`; release builds must not define it)
  - Widget: WidgetWeaverWidget/WidgetWeaverClipboardActionsWidget.swift
  - App intents (auto-detect + inbox): WidgetWeaver/WidgetWeaverClipboardInboxIntents.swift (contact creation disabled; must not ship as a surfaced feature)
  - Xcode project dependency: WidgetWeaver.xcodeproj/project.pbxproj (remove XCLocalSwiftPackageReference for ScreenActionsCore from the default build)
- PawPulse / “Latest Cat”:
  - Widget registration gate: WidgetWeaverWidget/WidgetWeaverWidgetBundle.swift (`#if PAWPULSE`)
  - Widget: WidgetWeaverWidget/WidgetWeaverPawPulseLatestCatWidget.swift
  - App views/settings: Shared/PawPulseLatestCatDetailView.swift, Shared/PawPulseSettingsView.swift
  - Runtime gating helper: Shared/WidgetWeaverFeatureFlags.swift (`pawPulseEnabled`, default off)
  - Background tasks: Shared/PawPulseBackgroundTasks.swift (runtime gated; cancels pending requests when disabled or when no base URL is configured)

Non-negotiables
- Do not run heavy work in widgets.
- Do not introduce WidgetCenter reload loops from widget providers.
- Do not break existing user widgets when removing templates from Explore.
- Do not ship a build that requests Contacts permission or declares Contacts usage strings.
- Do not ship a build that can request Location authorisation without `NSLocationWhenInUseUsageDescription` in Info.plist.
- Clipboard Actions is parked: release builds must not register it in the widget gallery and must not depend on ScreenActionsCore.
