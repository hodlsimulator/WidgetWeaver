WidgetWeaver – chat handoff (copy/paste)
Last updated: 2026-01-23

Product
- WidgetWeaver is an iOS 26+ app that builds and previews real WidgetKit widgets via an Explore (template catalogue) + context-aware editor workflow.
- Widgets must be deterministic and budget-safe; heavy work (Vision, ranking, photo prep) happens in the app; widgets render from App Group state.
- Sharing/export uses a `.wwdesign` design package file type (JSON under the hood) for backup and exchange.

Strategic intent
- “Super complex, super simple”: powerful capabilities under the hood, but progressive disclosure in the UI.
- Ship a coherent flagship set, not a wide permission-heavy grab bag.

Near-term schedule
- Today: 2026-01-23.
- Feature freeze: 2026-01-31 (stop adding features).
- Polish: 2026-02-01 to 2026-02-14.
- Target ship: 2026-02-14 to 2026-02-16.

Current roadmap priorities (pre-freeze)
1) Photos: make Smart Photos + poster/photo widgets feel flagship (fast, reliable, good defaults).
2) Clock: Home Screen correctness and predictable customisation updates.
3) Noise Machine: promote it; keep responsiveness rock-solid; add 1–2 scoped upgrades only.
4) Variables: make them more accessible/discoverable, especially during text editing; surface built-in keys.
5) Reduce surface area and permission footprint (do not break existing widgets):
   - Hide “Reading” from Explore / starter surfaces.
   - Remove the “Photo Quote” template from Explore / starter surfaces.
   - Clipboard Actions is parked. Keep it out of Explore and first-run paths and keep the runtime gate off (`WidgetWeaverFeatureFlags.clipboardActionsEnabled`, default off). When the flag is off, AppIntents must return a disabled status (no Calendar/Reminders writes) and must not trigger any permission prompts (especially Contacts). Do not propose or prioritise work that improves or expands Clipboard Actions.
   - Keep PawPulse / “Latest Cat” (cat adoption) out of shipped surfaces. The widget is compile-time gated (no gallery presence unless `PAWPULSE` is defined) and background refresh is runtime gated (`WidgetWeaverFeatureFlags.pawPulseEnabled`, default off). Refresh scheduling is cancelled when disabled (or when no base URL is configured).

Defer
- Weather: later (post-ship) unless it is already rock-solid; can be hidden/experimental.
- AI: post-ship R&D track; small, reviewable assistive steps; must generate explicit specs/config, not opaque state.

Key repo pointers
- Design export/import: WidgetWeaver/ContentView+SharePackage.swift (Transferable `.wwdesign` files)
- Document type registration: WidgetWeaver/Info.plist (UTType export + document type + open-in-place declaration)
- Smart Photos pipeline: WidgetWeaver/SmartPhotoPipeline/*
- Crop editor: WidgetWeaver/SmartPhotoCropEditorView.swift
- Poster background/overlay: Shared/WidgetWeaverSpecView+Background.swift, Shared/WidgetWeaverSpecView.swift
- Home Screen clock widget: WidgetWeaverWidget/WidgetWeaverHomeScreenClockWidget.swift
- Clock live view: WidgetWeaverWidget/Clock/WidgetWeaverClockWidgetLiveView.swift
- Noise Machine widget: WidgetWeaverWidget/WidgetWeaverNoiseMachineWidget.swift
- Template catalogue entries: WidgetWeaver/WidgetWeaverAboutCatalog.swift
- Variable resolution: Shared/WidgetSpec+Utilities.swift, Shared/WidgetSpec+VariableResolutionNow.swift
- Variables UI: WidgetWeaver/WidgetWeaverVariablesView.swift (and related sheets)
- DEBUG feature flag toggles (Reminders / Clipboard Actions (parked) / PawPulse): WidgetWeaver/ContentView+Toolbar.swift

Feature removal / hiding pointers
- “Reading” template surfaces: WidgetWeaver/WidgetWeaverAboutCatalog.swift (and any Explore listings)
- “Photo Quote” template: WidgetWeaver/WidgetWeaverAboutCatalog.swift, Shared/WidgetSpec+Utilities.swift (spec helper)
- Clipboard Actions (parked):
  - Widget: WidgetWeaverWidget/WidgetWeaverClipboardActionsWidget.swift (renders “Hidden by default” when the runtime flag is off; taps open the app)
  - App intents (auto-detect + inbox): WidgetWeaver/WidgetWeaverClipboardInboxIntents.swift (contact creation disabled; hard-gated by `clipboardActionsEnabled` and returns disabled when off)
  - Runtime gating helper: Shared/WidgetWeaverFeatureFlags.swift (`clipboardActionsEnabled`, default off)
- PawPulse / “Latest Cat”:
  - Widget registration gate: WidgetWeaverWidget/WidgetWeaverWidgetBundle.swift (`#if PAWPULSE`)
  - Widget: WidgetWeaverWidget/WidgetWeaverPawPulseLatestCatWidget.swift
  - App views/settings: Shared/PawPulseLatestCatDetailView.swift, Shared/PawPulseSettingsView.swift
  - Runtime gating helper: Shared/WidgetWeaverFeatureFlags.swift (`pawPulseEnabled`, default off)
  - Background tasks: Shared/PawPulseBackgroundTasks.swift (runtime gated; cancels pending requests when disabled or when no base URL is configured)

Non-negotiables
- Do not run heavy work in widgets.
- Do not introduce WidgetCenter reload loops from widget providers.
- Do not break existing user widgets when removing templates from Explore.
- Do not ship a build that requests Contacts permission.
- Clipboard Actions is parked: keep it inert and default-off; do not revive it via patches.
